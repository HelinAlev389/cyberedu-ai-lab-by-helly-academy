{% extends 'base.html' %}
{% block content %}

<div class="max-w-4xl mx-auto px-6 py-8 space-y-8">
  <h1 class="text-3xl font-bold text-gray-800">üìä –û—Ü–µ–Ω–∫–∞ –Ω–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è—Ç–∞</h1>

  <div class="bg-white rounded-2xl shadow-lg p-6 space-y-6">
    {% if results %}
      <p class="text-lg font-medium text-gray-700">üìà –°—Ä–µ–¥–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç:
        <span class="text-indigo-600 font-bold">{{ average }}%</span>
      </p>

      <div class="space-y-4">
        {% for res in results %}
          <div class="p-4 rounded-xl border border-gray-200 bg-gray-50">
            <h3 class="text-md font-semibold text-gray-800">
              –í—ä–ø—Ä–æ—Å {{ res.id|upper }}
            </h3>
            <p class="mt-1 text-sm text-gray-700">
              ‚úÖ –û—Ü–µ–Ω–∫–∞: <span class="font-medium text-green-700">{{ res.score }}%</span>
            </p>
            <p class="mt-1 text-sm text-gray-600 italic">üí¨ –û–±—Ä–∞—Ç–Ω–∞ –≤—Ä—ä–∑–∫–∞: {{ res.feedback }}</p>
          </div>
        {% endfor %}
      </div>

      <div class="mt-6">
        {% if average >= 80 %}
          <div class="bg-green-100 border-l-4 border-green-500 text-green-800 p-4 rounded">
            –ß—É–¥–µ—Å–Ω–∞ —Ä–∞–±–æ—Ç–∞! –ú–æ–∂–µ—à –¥–∞ –ø—Ä–µ–º–∏–Ω–µ—à –∫—ä–º —Å–ª–µ–¥–≤–∞—â–∞—Ç–∞ —Ç–µ–º–∞. ‚úÖ
          </div>
        {% elif average >= 50 %}
          <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-4 rounded">
            –°—Ä–µ–¥–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç ‚Äì –ø—Ä–µ–ø–æ—Ä—ä—á–≤–∞ —Å–µ –ø—Ä–µ–≥–ª–µ–¥ –Ω–∞ –∫–ª—é—á–æ–≤–∏ –ø–æ–Ω—è—Ç–∏—è. ‚ö†Ô∏è
          </div>
        {% else %}
          <div class="bg-red-100 border-l-4 border-red-500 text-red-800 p-4 rounded">
            –ù–∏—Å—ä–∫ —Ä–µ–∑—É–ª—Ç–∞—Ç ‚Äì –≤—ä—Ä–Ω–∏ —Å–µ –∏ –ø–æ–≤—Ç–æ—Ä–∏ —É—Ä–æ–∫–∞. ‚ùó
          </div>
        {% endif %}
      </div>

      <div class="mt-8 text-right">
        <a href="{{ url_for('ai_teacher.lesson') }}" class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded">
          üîÅ –ü–æ–≤—Ç–æ—Ä–∏ —É—Ä–æ–∫–∞
        </a>
      </div>
    {% else %}
      <p class="text-red-600 font-medium">–ù—è–º–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –∑–∞ –ø–æ–∫–∞–∑–≤–∞–Ω–µ.</p>
    {% endif %}
    {% if exercises %}
<div class="bg-white p-6 rounded-xl shadow mt-10">
  <h2 class="text-xl font-bold text-gray-800 mb-4">üîç –°—Ç—ä–ø–∫–æ–≤–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h2>
  <div id="step-container" class="space-y-6">
    {% for step in exercises.split('\n\n') %}
      <div class="step hidden p-4 border-l-4 border-indigo-500 bg-gray-50 rounded-lg shadow">
        <p class="text-gray-800 text-md font-medium">{{ step.strip() }}</p>
        <textarea rows="3" class="w-full mt-3 p-2 border rounded focus:ring-indigo-500" placeholder="–í–∞—à–∏—è—Ç –æ—Ç–≥–æ–≤–æ—Ä..."></textarea>
        <button class="next-step mt-3 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded">–°–ª–µ–¥–≤–∞—â–∞ —Å—Ç—ä–ø–∫–∞</button>
      </div>
    {% endfor %}
  </div>
</div>

<script>
  const steps = document.querySelectorAll('.step');
  const buttons = document.querySelectorAll('.next-step');

  if (steps.length) steps[0].classList.remove('hidden');

  buttons.forEach((btn, idx) => {
    btn.addEventListener('click', () => {
      btn.disabled = true;
      if (steps[idx + 1]) steps[idx + 1].classList.remove('hidden');
    });
  });
</script>
{% endif %}

  </div>
</div>

{% endblock %}
