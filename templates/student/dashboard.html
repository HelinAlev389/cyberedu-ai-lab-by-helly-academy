{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">üéì –ú–æ–µ—Ç–æ —Ç–∞–±–ª–æ</h2>

  <!-- üèÜ –ü–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
  <h4 class="mt-5">üèÜ –ú–æ–∏—Ç–µ –ø–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h4>
  <div class="d-flex gap-3 flex-wrap mb-4">
    <span class="badge bg-primary p-2">üéØ –ê–∫—Ç–∏–≤–µ–Ω —Å—Ç—É–¥–µ–Ω—Ç</span>
    {% if memories|length > 10 %}
      <span class="badge bg-warning text-dark p-2">üß† 10+ AI –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è</span>
    {% endif %}
    {% if progress|selectattr("completed")|list|length >= 3 %}
      <span class="badge bg-success p-2">üìö –ó–∞–≤—ä—Ä—à–∏ 3+ —É—Ä–æ–∫–∞</span>
    {% endif %}
  </div>

  <!-- üß† AI –ò–Ω—Ç–µ—Ä–∞–∫—Ü–∏–∏ -->
  <h4 class="mb-3">üß† –ò—Å—Ç–æ—Ä–∏—è –Ω–∞ AI –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è</h4>
  {% if memories %}
  <div class="table-responsive">
    <table class="table table-striped table-bordered">
      <thead class="table-light">
        <tr>
          <th>–î–∞—Ç–∞</th>
          <th>–°—ä–æ–±—â–µ–Ω–∏–µ</th>
          <th>–¢–∞–≥</th>
          <th>–û—Ü–µ–Ω–∫–∞</th>
        </tr>
      </thead>
      <tbody>
        {% for memory in memories %}
        <tr>
          <td>{{ memory.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
          <td>{{ memory.content or "-" }}</td>
          <td>{{ memory.tag or "-" }}</td>
          <td>{{ memory.score if memory.score is not none else "-" }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <p class="text-muted">‚ùó –ù—è–º–∞—Ç–µ –∑–∞–ø–∏—Å–∞–Ω–∏ AI –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.</p>
  {% endif %}

  <div class="my-4 d-flex gap-2 flex-wrap">
    <a href="{{ url_for('student_dashboard.completed_lessons') }}" class="btn btn-outline-success">
      ‚úÖ –í–∏–∂ –∑–∞–≤—ä—Ä—à–µ–Ω–∏—Ç–µ —É—Ä–æ—Ü–∏
    </a>
    <a href="{{ url_for('student_dashboard.export_pdf') }}" class="btn btn-outline-secondary">
      üìÑ –ò–∑—Ç–µ–≥–ª–∏ PDF —Å –º–æ—è—Ç–∞ –∏—Å—Ç–æ—Ä–∏—è
    </a>
  </div>

  <!-- üìö –ü—Ä–µ–ø–æ—Ä—ä—á–∞–Ω–∏ —É—Ä–æ—Ü–∏ -->
  <h4 class="mt-5 mb-3">üìö –ü—Ä–µ–ø–æ—Ä—ä—á–∞–Ω–∏ —É—Ä–æ—Ü–∏</h4>
  {% if lessons %}
  <div class="row">
    {% for lesson in lessons %}
    <div class="col-md-6 col-lg-4 mb-4">
      <div class="card shadow border-0 h-100">
        <div class="card-body d-flex flex-column justify-content-between">
          <div>
            <h5 class="card-title text-primary">{{ lesson.title }}</h5>
            <p class="text-muted mb-1"><i class="bi bi-book"></i> {{ lesson.topic }}</p>

            {% set p = progress.get(lesson.id) %}
            {% if p and p.completed %}
              <span class="badge bg-success mb-2">‚úÖ –ó–∞–≤—ä—Ä—à–µ–Ω</span>
            {% else %}
              <span class="badge bg-warning text-dark mb-2">üïí –ü—Ä–µ–¥—Å—Ç–æ–∏</span>
            {% endif %}

            {% if p %}
            <div class="progress mb-2" style="height: 8px;">
              <div class="progress-bar" role="progressbar"
                   style="width: {{ p.progress }}%;" aria-valuenow="{{ p.progress }}"
                   aria-valuemin="0" aria-valuemax="100">
              </div>
            </div>
            <small class="text-muted">–ü—Ä–æ–≥—Ä–µ—Å: {{ p.progress }}%</small>
            {% endif %}
          </div>
          <div class="mt-3">
            <a href="{{ url_for('teacher_dashboard.view_lesson', lesson_id=lesson.id) }}"
               class="btn btn-sm btn-outline-primary w-100">üìñ –ü—Ä–µ–≥–ª–µ–¥</a>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <p class="text-muted">‚ùó –ù—è–º–∞ –ø—Ä–µ–ø–æ—Ä—ä—á–∞–Ω–∏ —É—Ä–æ—Ü–∏ –∑–∞ –º–æ–º–µ–Ω—Ç–∞.</p>
  {% endif %}
</div>
{% endblock %}
