{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2 class="mb-1">{{ lesson.title }}</h2>
  <p class="text-muted">{{ lesson.topic or '–ë–µ–∑ —Ç–µ–º–∞' }}</p>

  <div class="lesson-content border rounded p-3 mb-4" style="background: #f9f9f9;">
    {{ lesson.content | safe }}
  </div>

  <!-- üìù –ë–µ–ª–µ–∂–∫–∏ -->
  <h5 class="mt-4">üìù –ú–æ–∏—Ç–µ –±–µ–ª–µ–∂–∫–∏</h5>
  <form method="POST" onsubmit="syncLessonEditor()">
    <input type="hidden" name="content" id="hidden-content">

    {% if improved %}
      <label class="form-label">‚ú® AI –ø–æ–¥–æ–±—Ä–µ–Ω–∞ –≤–µ—Ä—Å–∏—è:</label>
      <textarea name="improved_content" class="form-control mb-2" rows="6">{{ improved }}</textarea>
      <div class="d-flex justify-content-between">
        <button type="submit" name="action" value="save_ai" class="btn btn-success btn-sm">üíæ –ó–∞–ø–∞–∑–∏ AI –≤–µ—Ä—Å–∏—è—Ç–∞</button>
        <a href="{{ url_for('student_dashboard.view_lesson', lesson_id=lesson.id) }}" class="btn btn-outline-secondary btn-sm">–û—Ç–∫–∞–∑</a>
      </div>
    {% else %}
      <div id="lesson-editor" class="quill-editor" style="height: 200px;">
        {{ note.content | safe }}
      </div>
      <div class="d-flex justify-content-between mt-2">
        <small class="text-muted">–û–±–Ω–æ–≤–µ–Ω–æ: {{ note.updated_at.strftime('%d.%m.%Y %H:%M') }}</small>
        <div class="d-flex gap-2">
          <button type="submit" name="action" value="save" class="btn btn-sm btn-success">üíæ –ó–∞–ø–∞–∑–∏</button>
          <button type="submit" name="action" value="improve" class="btn btn-sm btn-warning">‚ú® –ü–æ–¥–æ–±—Ä–∏ —Å AI</button>
        </div>
      </div>
    {% endif %}
  </form>
</div>
{% endblock %}
