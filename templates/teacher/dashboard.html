{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">üë©‚Äçüè´ –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—Å–∫–æ —Ç–∞–±–ª–æ</h2>

  <!-- –ö–∞—Ä—Ç–∏ —Å –æ–±–æ–±—â–µ–Ω–∏—è -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card shadow rounded-3 p-3">
        <h5>üìö –û–±—â–æ —É—Ä–æ—Ü–∏</h5>
        <p class="fs-3">{{ lesson_count }}</p>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow rounded-3 p-3">
        <h5>üë®‚Äçüéì –ê–∫—Ç–∏–≤–Ω–∏ —Å—Ç—É–¥–µ–Ω—Ç–∏</h5>
        <p class="fs-3">{{ student_count }}</p>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow rounded-3 p-3">
        <h5>üß† AI –ò–Ω—Ç–µ—Ä–∞–∫—Ü–∏–∏</h5>
        <p class="fs-3">{{ memory_count }}</p>
      </div>
    </div>
  </div>

  <!-- –ü—Ä–µ–ø–æ—Ä—ä—á–∞–Ω–∏ —É—Ä–æ—Ü–∏ -->
  {% if recommended %}
  <div class="card mb-4">
    <div class="card-header bg-light">
      <h5 class="mb-0">üìå –ü—Ä–µ–ø–æ—Ä—ä—á–∞–Ω–∏ —É—Ä–æ—Ü–∏ –∑–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</h5>
    </div>
    <ul class="list-group list-group-flush">
      {% for lesson in recommended %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <strong>{{ lesson.title }}</strong>
        <a href="{{ url_for('teacher_dashboard.view_lesson', lesson_id=lesson.id) }}" class="btn btn-sm btn-outline-info">–ü—Ä–µ–≥–ª–µ–¥</a>
      </li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <!-- –ë—ä—Ä–∑–∏ –¥–µ–π—Å—Ç–≤–∏—è -->
  <div class="d-flex gap-2 mb-4">
    <a href="{{ url_for('teacher_dashboard.manage_lessons') }}" class="btn btn-success">‚úçÔ∏è –°—ä–∑–¥–∞–π —É—Ä–æ–∫</a>
    <a href="{{ url_for('teacher_dashboard.view_progress') }}" class="btn btn-primary">üìà –ü—Ä–æ–≥—Ä–µ—Å –Ω–∞ —Å—Ç—É–¥–µ–Ω—Ç–∏</a>
  </div>

  <hr class="my-4">

  <!-- –§–∏–ª—Ç—ä—Ä –ø–æ —Å—Ç—É–¥–µ–Ω—Ç -->
  <form method="get" action="{{ url_for('teacher_dashboard.dashboard') }}" class="mb-3">
    <label for="studentFilter" class="form-label">üë§ –§–∏–ª—Ç—Ä–∏—Ä–∞–π –ø–æ —Å—Ç—É–¥–µ–Ω—Ç:</label>
    <div class="d-flex gap-2">
      <select name="student_id" id="studentFilter" class="form-select w-auto">
        <option value="">-- –í—Å–∏—á–∫–∏ --</option>
        {% for student in students %}
          <option value="{{ student.id }}" {% if selected_student_id == student.id %}selected{% endif %}>
            {{ student.username }}
          </option>
        {% endfor %}
      </select>
      <button type="submit" class="btn btn-outline-primary">–§–∏–ª—Ç—Ä–∏—Ä–∞–π</button>
      <a href="{{ url_for('teacher_dashboard.export_pdf', student_id=selected_student_id) }}" class="btn btn-outline-secondary">
        ‚¨áÔ∏è –ï–∫—Å–ø–æ—Ä—Ç–∏—Ä–∞–π PDF
      </a>
    </div>
  </form>

  <!-- –¢–∞–±–ª–∏—Ü–∞ —Å AI —Å—ä–æ–±—â–µ–Ω–∏—è -->
  <div class="table-responsive">
    <table class="table table-striped table-bordered">
      <thead class="table-light">
        <tr>
          <th>–î–∞—Ç–∞</th>
          <th>–°—Ç—É–¥–µ–Ω—Ç</th>
          <th>–°—ä–æ–±—â–µ–Ω–∏–µ</th>
          <th>–¢–∞–≥</th>
          <th>–û—Ü–µ–Ω–∫–∞</th>
        </tr>
      </thead>
      <tbody>
        {% for memory in memories %}
        <tr>
          <td>{{ memory.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
          <td>{{ memory.user.username }}</td>
          <td>{{ memory.content or "" | truncate(80) }}</td>
          <td>{{ memory.tag or "-" }}</td>
          <td>{{ memory.score if memory.score is not none else "-" }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
