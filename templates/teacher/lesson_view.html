{% extends "base.html" %}

{% block content %}
<!-- EasyMDE CSS -->
<link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<style>
.lesson-content pre {
  background-color: #f8f9fa;
  padding: 1rem;
  border-radius: 8px;
  overflow-x: auto;
}
.lesson-content code {
  background-color: #f1f1f1;
  padding: 2px 6px;
  border-radius: 4px;
  font-family: monospace;
}
.lesson-content table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1rem;
}
.lesson-content th, .lesson-content td {
  border: 1px solid #dee2e6;
  padding: 0.75rem;
}
.lesson-content th {
  background-color: #f1f3f5;
}
</style>

<div class="container mt-5 mb-5">
  <div class="bg-white p-5 shadow rounded-3 border">
    <h2 class="display-5 fw-bold text-primary mb-3">{{ lesson.title }}</h2>
    <p><span class="badge bg-secondary fs-6">{{ lesson.topic }}</span></p>

    <div class="lesson-content mt-4 text-body" style="line-height: 1.8; font-size: 1.1rem;">
  {{ html_content | safe }}
    </div>
    <h3>–ú–∏–Ω–∏ –∫—É–∏–∑</h3>

<p>1. –ö–∞–∫–≤–æ –µ IP –∞–¥—Ä–µ—Å?</p>
<label><input type="radio" name="q1" value="a"> –£–Ω–∏–∫–∞–ª–µ–Ω –Ω–æ–º–µ—Ä –≤ –º—Ä–µ–∂–∞—Ç–∞</label><br>
<label><input type="radio" name="q1" value="b"> –ü—Ä–æ–≥—Ä–∞–º–∞ –∑–∞ —Ö–∞–∫–≤–∞–Ω–µ</label><br>

<p>2. –ö–∞–∫–≤–æ –µ DNS?</p>
<label><input type="radio" name="q2" value="a"> –ü—Ä–æ—Ç–æ–∫–æ–ª –∑–∞ —Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ</label><br>
<label><input type="radio" name="q2" value="b"> –°–∏—Å—Ç–µ–º–∞ –∑–∞ –∏–º–µ–Ω–∞ –Ω–∞ –¥–æ–º–µ–π–Ω–∏</label><br>

<div id="quiz-result" class="mt-3 fw-bold"></div>
<button class="btn btn-primary mt-2" onclick="checkQuiz()">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏—Ç–µ</button>


    <div class="text-center mt-5">
  <button class="btn btn-outline-success" onclick="submitScore(2, {{ lesson.id }})">
    üì© –ó–∞–ø–∏—à–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞
  </button>
</div>



    <hr class="my-5">

    {% if recommended %}
      <h4 class="mb-4">üìö –ü—Ä–µ–ø–æ—Ä—ä—á–∞–Ω–∏ —É—Ä–æ—Ü–∏</h4>
      {% if lessons %}
        <div class="row">
          {% for lesson in lessons %}
          <div class="col-md-6 col-lg-4 mb-4">
            <div class="card shadow-sm h-100 border-0">
              <div class="card-body d-flex flex-column justify-content-between">
                <div>
                  <h5 class="card-title text-primary">{{ lesson.title }}</h5>
                  <p class="text-muted"><i class="bi bi-book"></i> {{ lesson.topic }}</p>
                  <span class="badge bg-info text-dark">AI Lesson</span>
                </div>
                <a href="{{ url_for('teacher_dashboard.view_lesson', lesson_id=lesson.id) }}"
                   class="btn btn-outline-primary mt-3">üìñ –ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ —É—Ä–æ–∫–∞</a>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-muted">‚ùó –ù—è–º–∞ –ø—Ä–µ–ø–æ—Ä—ä—á–∞–Ω–∏ —É—Ä–æ—Ü–∏ –∑–∞ –º–æ–º–µ–Ω—Ç–∞.</p>
      {% endif %}
    {% endif %}

    <a href="{{ url_for('teacher_dashboard.manage_lessons') }}" class="btn btn-outline-secondary mt-4">
      ‚Üê –ù–∞–∑–∞–¥ –∫—ä–º —É—Ä–æ—Ü–∏
    </a>
  </div>
</div>

<!-- EasyMDE JS -->
<script>
function checkQuiz() {
  let correct = 0;
  const resultBox = document.getElementById("quiz-result");

  const q1 = document.querySelector('input[name="q1"]:checked');
  const q2 = document.querySelector('input[name="q2"]:checked');

  if (q1 && q1.value === "a") correct++;
  if (q2 && q2.value === "b") correct++;

  if (!q1 || !q2) {
    resultBox.innerHTML = "‚ùó –ú–æ–ª—è, –æ—Ç–≥–æ–≤–æ—Ä–∏ –Ω–∞ –≤—Å–∏—á–∫–∏ –≤—ä–ø—Ä–æ—Å–∏.";
    resultBox.className = "text-warning";
  } else if (correct === 2) {
    resultBox.innerHTML = "üéâ –°—Ç—Ä–∞—Ö–æ—Ç–Ω–æ! –í–µ—Ä–Ω–∏ –∏ –¥–≤–∞—Ç–∞ –æ—Ç–≥–æ–≤–æ—Ä–∞!";
    resultBox.className = "text-success";
  } else {
    resultBox.innerHTML = `üîç –í–µ—Ä–Ω–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏: ${correct} –æ—Ç 2. –ü—Ä–µ–≥–ª–µ–¥–∞–π —É—Ä–æ–∫–∞ –ø–∞–∫!`;
    resultBox.className = "text-danger";
  }
}
</script>
<script>
function submitScore(score, lessonId) {
  fetch(`/lesson/${lessonId}/submit_quiz`, {
    method: 'POST',
    headers: {'Content-Type': 'application/x-www-form-urlencoded'},
    body: `score=${score}`
  })
  .then(response => {
    if (response.ok) {
      alert("üéâ –†–µ–∑—É–ª—Ç–∞—Ç—ä—Ç –µ –∑–∞–ø–∏—Å–∞–Ω!");
    } else {
      alert("‚ö†Ô∏è –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç.");
    }
  })
  .catch(() => alert("‚ö†Ô∏è –ù–µ–≤—ä–∑–º–æ–∂–Ω–∞ –≤—Ä—ä–∑–∫–∞ —Å—ä—Å —Å—ä—Ä–≤—ä—Ä–∞."));
}
</script>


<script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>
{% endblock %}
