{% extends "base.html" %}
{% block content %}

<!-- EasyMDE CSS -->
<link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<h2 class="mt-4">üìö –°—ä–∑–¥–∞–π –Ω–æ–≤ —É—Ä–æ–∫</h2>
<div class="d-flex justify-content-end mt-3">
  <a href="{{ url_for('teacher_dashboard.generate_lesson') }}" class="btn btn-outline-success">
    ‚ú® –°—ä–∑–¥–∞–π AI —É—Ä–æ–∫
  </a>
</div>

<form method="POST" class="mt-3">
  {{ form.hidden_tag() }}
  <div class="mb-3">
    {{ form.title.label(class="form-label") }}
    {{ form.title(class="form-control") }}
  </div>
  <div class="mb-3">
    {{ form.topic.label(class="form-label") }}
    {{ form.topic(class="form-select") }}
  </div>
  <div class="mb-3">
    {{ form.content.label(class="form-label") }}
    {{ form.content(class="form-control", rows=5) }}
    <div class="form-text">–ú–æ–∂–µ—à –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞—à Markdown –∏–ª–∏ HTML</div>
  </div>
  <button type="submit" class="btn btn-primary">üíæ –°—ä–∑–¥–∞–π —É—Ä–æ–∫</button>
</form>

<hr class="my-4">

<h3 class="mb-3">üìù –ß–µ—Ä–Ω–æ–≤–∏</h3>
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
  {% for lesson in lessons if not lesson.is_published %}
    <div class="col">
      <div class="card h-100 border-warning shadow-sm">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title text-warning">{{ lesson.title }}</h5>
          <p class="card-text text-muted">
            <span class="badge bg-secondary">{{ lesson.topic }}</span>
          </p>
          <div class="lesson-card-content small text-secondary flex-grow-1">
            {{ lesson.content }}
          </div>
          <div class="d-flex flex-wrap justify-content-between mt-3 gap-2">
            <a href="{{ url_for('teacher_dashboard.edit_lesson', lesson_id=lesson.id) }}" class="btn btn-sm btn-outline-warning flex-fill">‚úèÔ∏è</a>
            <form method="POST" action="{{ url_for('teacher_dashboard.publish_lesson', lesson_id=lesson.id) }}" class="d-inline w-10">
              {{ csrf_token() }}
              <button type="submit" class="btn btn-sm btn-success w-100">üì¢ –ü—É–±–ª–∏–∫—É–≤–∞–π</button>
            </form>
            <form method="POST" action="{{ url_for('teacher_dashboard.delete_lesson', lesson_id=lesson.id) }}" onsubmit="return confirm('–ù–∞–∏—Å—Ç–∏–Ω–∞ –ª–∏ –∏—Å–∫–∞—à –¥–∞ –∏–∑—Ç—Ä–∏–µ—à —Ç–æ–∑–∏ —É—Ä–æ–∫?');">
  {{ csrf_token() }}
  <button type="submit" class="btn btn-sm btn-outline-danger w-100">üóëÔ∏è</button>
</form>

          </div>
        </div>
      </div>
    </div>
  {% endfor %}
</div>

<hr class="my-4">

<h3 class="mb-3">‚úÖ –ü—É–±–ª–∏–∫—É–≤–∞–Ω–∏ —É—Ä–æ—Ü–∏</h3>
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
  {% for lesson in lessons if lesson.is_published %}
    <div class="col">
      <div class="card h-100 border-success shadow-sm">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title text-success">{{ lesson.title }}</h5>
          <p class="card-text text-muted">
            <span class="badge bg-secondary">{{ lesson.topic }}</span>
          </p>
          <div class="lesson-card-content small text-secondary flex-grow-1">
            {{ lesson.content }}
          </div>
          <div class="d-flex flex-wrap justify-content-between mt-3 gap-2">
            <a href="{{ url_for('teacher_dashboard.view_lesson', lesson_id=lesson.id) }}" class="btn btn-sm btn-outline-primary flex-fill">üëÅÔ∏è</a>
            <a href="{{ url_for('teacher_dashboard.edit_lesson', lesson_id=lesson.id) }}" class="btn btn-sm btn-outline-warning flex-fill">‚úèÔ∏è</a>
            <form method="POST" action="{{ url_for('teacher_dashboard.delete_lesson', lesson_id=lesson.id) }}" onsubmit="return confirm('–ù–∞–∏—Å—Ç–∏–Ω–∞ –ª–∏ –∏—Å–∫–∞—à –¥–∞ –∏–∑—Ç—Ä–∏–µ—à —Ç–æ–∑–∏ —É—Ä–æ–∫?');">
  {{ csrf_token() }}
  <button type="submit" class="btn btn-sm btn-outline-danger w-100">üóëÔ∏è</button>
</form>

          </div>
        </div>
      </div>
    </div>
  {% endfor %}
</div>

<!-- Markdown Editor JS -->
<script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>
<script>
  const editor = new EasyMDE({
    element: document.querySelector('textarea[name="content"]'),
    imageUpload: true,
    uploadImage: true,
    imagePath: "/static/uploads/",
    toolbar: [
      "bold", "italic", "heading", "|",
      "quote", "unordered-list", "ordered-list", "|",
      "link", "image", "preview", "guide"
    ]
  });
</script>

{% endblock %}
