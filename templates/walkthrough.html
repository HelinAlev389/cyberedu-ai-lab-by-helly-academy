<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>AI Guided Walkthrough</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .step { display: none; }
        .step.active { display: block; }
    </style>
</head>
<body>
<div class="container mt-4">
    <h2>Интерактивен AI анализ на SOC лог</h2>
    <form id="walkthroughForm">
        <div id="step-1" class="step active">
            <label for="logInput">Въведи JSON лог:</label>
            <textarea class="form-control" id="logInput" rows="6"></textarea>
            <button type="button" class="btn btn-primary mt-3" onclick="nextStep(1)">Продължи</button>
        </div>

        <div id="step-2" class="step">
            <label>Какъв тип инцидент мислиш, че е това?</label>
            <input type="text" class="form-control" id="answer1">
            <button type="button" class="btn btn-primary mt-3" onclick="getFeedback(1)">Изпрати</button>
            <div id="feedback1" class="mt-2"></div>
        </div>

        <div id="step-3" class="step">
            <label>Оцени риска (Low, Medium, High):</label>
            <input type="text" class="form-control" id="answer2">
            <button type="button" class="btn btn-primary mt-3" onclick="getFeedback(2)">Изпрати</button>
            <div id="feedback2" class="mt-2"></div>
        </div>

        <div id="step-4" class="step">
            <label>Какво се случва в лога?</label>
            <textarea class="form-control" id="answer3"></textarea>
            <button type="button" class="btn btn-primary mt-3" onclick="getFeedback(3)">Изпрати</button>
            <div id="feedback3" class="mt-2"></div>
        </div>

        <div id="step-5" class="step">
            <label>Какво би препоръчал като реакция?</label>
            <textarea class="form-control" id="answer4"></textarea>
            <button type="button" class="btn btn-primary mt-3" onclick="getFeedback(4)">Изпрати</button>
            <div id="feedback4" class="mt-2"></div>
        </div>

        <div id="step-final" class="step">
            <h4>Финален анализ</h4>
            <button type="button" class="btn btn-success" onclick="generateSummary()">Генерирай обобщение</button>
            <pre id="summaryResult" class="mt-3"></pre>
        </div>
    </form>
</div>

<script>
    function nextStep(current) {
        document.getElementById(`step-${current}`).classList.remove("active");
        document.getElementById(`step-${current + 1}`).classList.add("active");
    }

    async function getFeedback(step) {
        const question = document.querySelector(`#step-${step + 1} label`).innerText;
        const answer = document.getElementById(`answer${step}`).value;
        const log = document.getElementById("logInput").value;

        const res = await fetch("/walkthrough-feedback", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ log, question, answer })
        });
        const data = await res.json();
        document.getElementById(`feedback${step}`).innerHTML = `<div class='alert alert-info'>${data.feedback}</div>`;
        nextStep(step + 1);
    }

    async function generateSummary() {
        const log = document.getElementById("logInput").value;
        const res = await fetch("/walkthrough-summary", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ log })
        });
        const data = await res.json();
        document.getElementById("summaryResult").innerText = data.summary;
    }
</script>
</body>
</html>
